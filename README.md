# CHAT-NP

[English](README_EN.md) | Русский

Локальный чат-бот на базе языковых моделей GGUF с поддержкой пресетов и REST API.

<img width="1101" height="342" alt="изображение" src="https://github.com/user-attachments/assets/bba5165b-b56c-4478-86be-077c5970828d" />

## Описание

CHAT-NP — это приложение для работы с локальными языковыми моделями в формате GGUF. Программа предоставляет два режима работы:

1. **Интерактивный режим** — консольный чат с выбором модели и пресета через удобное меню
2. **Серверный режим** — REST API для интеграции с другими приложениями

## Ключевые возможности

### Система пресетов

Пресеты — это готовые конфигурации для специализированных задач. Каждый пресет включает:

- **System prompt** — роль и контекст для модели
- **Instruction** — детальные инструкции по выполнению задачи
- **Examples** — примеры входных данных и ожидаемых ответов (few-shot learning)
- **Negative prompt** — что модель НЕ должна делать
- **Response format** — формат ответа
- **Параметры генерации** — max_tokens, stop_on_newline
- **Текущая дата** — автоматическая подстановка даты для задач с временным контекстом

### Встроенные пресеты

1. **price_classifier** — классификация товаров по цене (дешёвый/дорогой) с объяснением
2. **assistant** — дружелюбный помощник для общих вопросов
3. **translator_ru_en** — перевод с русского на английский
4. **code_reviewer** — анализ и ревью кода
5. **sentiment** — анализ тональности текста (позитивный/негативный/нейтральный)
6. **summarizer** — краткое изложение текста
7. **date_extractor** — извлечение дат из текста с автоматическим вычислением относительных дат

## Установка

### Требования

- Rust 1.70+
- GGUF модель (например, Qwen, LLaMA, Mistral)

### Сборка

```bash
cargo build --release
```

### Подготовка модели

1. Скачайте GGUF модель (например, с [Hugging Face](https://huggingface.co/models?library=gguf))
2. Положите файл `.gguf` в корневую директорию программы (рядом с исполняемым файлом)
3. Программа автоматически найдёт все `.gguf` файлы при запуске

**Рекомендуемые модели:**
- [Qwen3-1.7B-Q4_K_M.gguf](https://huggingface.co/Qwen/Qwen3-1.7B-GGUF) — компактная и быстрая
- [Qwen3-4B-Q4_K_M.gguf](https://huggingface.co/Qwen/Qwen3-4B-GGUF) — баланс качества и скорости
- Любые другие GGUF модели (LLaMA, Mistral, Phi и т.д.)

## Использование

### Интерактивный режим

```bash
chat-np.exe
```

Программа автоматически найдёт все `.gguf` файлы в текущей директории и предложит:
1. Выбрать модель (если их несколько)
2. Выбрать пресет или работать в режиме свободного чата
3. Начать диалог

**Навигация в меню:**
- `↑/↓` — перемещение по списку
- `Enter` — выбор
- `Esc` — выход

### Серверный режим

```bash
chat-np.exe --server
```

Сервер запустится на `http://127.0.0.1:3000`

#### API эндпоинты

**GET /models** — список доступных моделей
```bash
curl http://127.0.0.1:3000/models
```

**GET /presets** — список доступных пресетов
```bash
curl http://127.0.0.1:3000/presets
```

**POST /chat** — отправка запроса к модели
```bash
curl -X POST http://127.0.0.1:3000/chat \
  -H "Content-Type: application/json" \
  -d '{"prompt": "iPhone 15", "preset": "price_classifier"}'
```

Параметры запроса:
- `prompt` (обязательный) — текст запроса
- `preset` (опциональный) — имя пресета
- `model` (опциональный) — имя модели
- `system_prompt` (опциональный) — системный промпт (если не используется пресет)
- `max_tokens` (опциональный) — максимум токенов в ответе

## Настройка пресетов

Пресеты хранятся в файле `presets.json`. Вы можете редактировать существующие или добавлять новые.

### Пример пресета

```json
{
  "name": "price_classifier",
  "description": "Классификатор товаров по цене",
  "system_prompt": "Ты классификатор товаров для аукционов.",
  "instruction": "Определи, является ли товар ДЕШЁВЫМ или ДОРОГИМ.",
  "examples": [
    {"input": "хлеб", "output": "ДЕШЁВЫЙ - продукт массового спроса"},
    {"input": "iPhone 15", "output": "ДОРОГОЙ - дорогая электроника"}
  ],
  "response_format": "Формат: КАТЕГОРИЯ - краткое объяснение",
  "max_tokens": 50,
  "stop_on_newline": true,
  "include_current_date": false
}
```

### Параметры пресета

- `name` — уникальное имя пресета
- `description` — описание для пользователя
- `system_prompt` — основная роль модели
- `instruction` — детальные инструкции (опционально)
- `examples` — массив примеров для few-shot learning (опционально)
- `negative_prompt` — что НЕ делать (опционально)
- `response_format` — формат ответа (опционально)
- `max_tokens` — максимум токенов в ответе
- `stop_on_newline` — остановка генерации при переводе строки
- `include_current_date` — добавлять текущую дату в промпт (для задач с датами)

## Тестирование API

Используйте `test-api.bat` для быстрого тестирования всех пресетов:

```bash
test-api.bat
```

## Технологии

- **llama-cpp-2** — работа с GGUF моделями
- **axum** — веб-фреймворк для REST API
- **crossterm** — интерактивное консольное меню
- **chrono** — работа с датами и временем
- **serde/serde_json** — сериализация/десериализация JSON

## Лицензия

MIT
